var Config = require('./conf');

function init(reset) {
  /* Connection */
  var mongoose = require('mongoose');
  mongoose.connect(Config.CONNECTION_URL,
    {useMongoClient: true}
  );
  
  mongoose.connection.on('connected', function() {
    console.log('Mongoose connected to ' + Config.CONNECTION_URL);
    if (reset) {
      // Reset database on start
      console.log('Reset database');
      mongoose.connection.db.dropDatabase();
    }    
  });
  mongoose.connection.on('error', function(err) {
    console.log('Mongoose connection error: ' + err);
  });
  mongoose.connection.on('disconnected', function() {
    console.log('\nMongoose disconnected');
  });
  process.on('SIGINT', function() {
    mongoose.connection.close(function() {
      console.log('Mongoose disconnected through app termination');
      process.exit(0);
    });
  });
}

var Connection = {
  init: init
}

module.exports = Connection;