var mongoose = require('mongoose');
var Models = require('../models');
var Chance = require('chance');
var Samples = require('./samples');
var Villa = require('./subObjects').Villa;
var Price = require('./subObjects').Price;

var generator = function() {
  var chance = new Chance();
  var newService = {};
  
  var code, title, description, price, normal, thumbnail;
  var  nbVillas, codeVilla, numberVilla, maxVilla;
  
  var serviceLabels = Samples.SERVICES_LIST;
  for (var i = 0; i < serviceLabels.length; i++) {
    // villas generation
    var villas = [];
    nbVillas = 2;
    for (j = 1; j <= nbVillas; j++) {
      codeVilla = chance.string(Samples.CODE_PATTERN);
      numberVilla = chance.integer({
        min: 200,
        max: 500
      });
      maxVilla = chance.integer({
        min: 1,
        max: 5
      });
      villas.push(new Villa('#' + j + 'CODE', numberVilla, maxVilla));
    }
    
    // Price generation
    var value = chance.integer({
      min: 950,
      max: 7500
    });
    code = chance.string(Samples.CODE_PATTERN);
    currency = 'â‚¬';
    title = chance.pickone(Samples.SERVICES_DURATIONS_LIST);
    price = new Price(value, code, currency, title);
    
    // other infos
    code = chance.string(Samples.CODE_PATTERN_SHARP);
    title = Samples.SERVICES_LIST[i];
    description = chance.paragraph({
      sentences: 2
    });
    
    normal = Samples.IMAGES_URL.NORMAL;
    thumbnail = Samples.IMAGES_URL.THUMBNAIL;
    
    // New service generation
    newService = new Models.Service({
      'code': code,
      'title': title,
      'description': description,
      'price': price,
      'villas': villas,
      'image': {
        'normal': normal,
        'thumbnail': thumbnail
      }
    });

    newService.save(function(err, service) {
      if (err) return console.log(err);
      console.log('Service ' + service.title + ' saved !');
    });
  }
}

var Services = {
  generator: generator
}

module.exports = Services;